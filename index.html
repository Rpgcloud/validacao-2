<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O Bosque Murmurante</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Fundo escuro */
            color: #e2e8f0; /* Texto claro */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }
        .game-container {
            background-color: #2d3748; /* Tom mais escuro para o container */
            border-radius: 1rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-width: 800px;
            width: 100%;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .narrative-box {
            background-color: #4a5568;
            border-left: 4px solid #4299e1;
            padding: 1.5rem;
            border-radius: 0.5rem;
            line-height: 1.7;
        }
        .stat-bar {
            height: 10px;
            border-radius: 9999px;
            transition: width 0.5s ease-in-out;
        }
        .stat-bar-container {
            background-color: #718096;
            border-radius: 9999px;
            overflow: hidden;
        }
        .virtue-bar { background-color: #48bb78; }
        .vice-bar { background-color: #e53e3e; }

        .choice-button {
            background-color: #4a5568;
            transition: transform 0.2s, background-color 0.2s;
        }
        .choice-button:hover:not(:disabled) {
            transform: translateY(-3px);
            background-color: #616e81;
        }
        .restart-btn {
            background-color: #6b46c1;
            transition: background-color 0.2s;
        }
        .restart-btn:hover {
            background-color: #805ad5;
        }
        .unavailable-choice {
            background-color: #3b424f;
            color: #718096;
            cursor: not-allowed;
            filter: grayscale(100%);
        }
    </style>
</head>
<body>

<div id="game-container" class="game-container">
    <h1 class="text-3xl font-bold text-center text-white">O Bosque Murmurante</h1>

    <!-- Seção de Status -->
    <div id="stats-section" class="flex flex-col md:flex-row justify-between gap-4">
        <div class="w-full">
            <h2 class="text-lg font-bold mb-1 text-green-400">Virtudes</h2>
            <div class="flex items-center gap-2 mb-2">
                <span class="text-sm w-24">Coragem:</span>
                <div class="stat-bar-container w-full">
                    <div id="virtue-courage-bar" class="stat-bar virtue-bar" style="width: 0%;"></div>
                </div>
            </div>
            <div class="flex items-center gap-2 mb-2">
                <span class="text-sm w-24">Sabedoria:</span>
                <div class="stat-bar-container w-full">
                    <div id="virtue-wisdom-bar" class="stat-bar virtue-bar" style="width: 0%;"></div>
                </div>
            </div>
            <div class="flex items-center gap-2 mb-2">
                <span class="text-sm w-24">Compaixão:</span>
                <div class="stat-bar-container w-full">
                    <div id="virtue-compassion-bar" class="stat-bar virtue-bar" style="width: 0%;"></div>
                </div>
            </div>
        </div>
        <div class="w-full">
            <h2 class="text-lg font-bold mb-1 text-red-400">Vícios</h2>
            <div class="flex items-center gap-2 mb-2">
                <span class="text-sm w-24">Crueldade:</span>
                <div class="stat-bar-container w-full">
                    <div id="vice-cruelty-bar" class="stat-bar vice-bar" style="width: 0%;"></div>
                </div>
            </div>
            <div class="flex items-center gap-2 mb-2">
                <span class="text-sm w-24">Ambição:</span>
                <div class="stat-bar-container w-full">
                    <div id="vice-ambition-bar" class="stat-bar vice-bar" style="width: 0%;"></div>
                </div>
            </div>
            <div class="flex items-center gap-2 mb-2">
                <span class="text-sm w-24">Futilidade:</span>
                <div class="stat-bar-container w-full">
                    <div id="vice-futility-bar" class="stat-bar vice-bar" style="width: 0%;"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Seção de Narrativa e Escolhas -->
    <div class="narrative-box" id="narrative-container">
        <p id="narrative-text" class="text-lg"></p>
    </div>

    <div id="choices-container" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <!-- Botões de escolha serão adicionados dinamicamente aqui -->
    </div>

    <!-- Modal de Fim de Jogo -->
    <div id="end-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4">
        <div class="bg-gray-700 rounded-lg p-8 max-w-lg w-full text-center">
            <h2 id="end-title" class="text-3xl font-bold mb-4 text-white"></h2>
            <p id="end-text" class="text-lg leading-relaxed text-gray-200 mb-6"></p>
            <button id="restart-btn" class="restart-btn text-white font-bold py-3 px-8 rounded-lg">Jogar Novamente</button>
        </div>
    </div>
</div>

<script>
    // Dados do jogo: estrutura expandida para uma jornada mais longa
    // Adicionado mais pontos em certas escolhas para garantir que os requisitos sejam atingidos
    const gameData = {
        'start': {
            narrative: "Você acorda sob a luz pálida da lua, no coração do Bosque Murmurante. Uma voz suave, mas persistente, ecoa em sua mente: 'Busque o Coração do Bosque. Só ele pode silenciar os lamentos desta terra'. Uma trilha se divide à sua frente. Para onde você vai?",
            choices: [
                { text: "Siga o caminho da luz, que brilha com uma aura pacífica.", next: 'path_of_light', virtues: { courage: 2, compassion: 2 } },
                { text: "Siga o caminho da sombra, que promete segredos ancestrais.", next: 'path_of_shadow', vices: { ambition: 2, futility: 2 } }
            ]
        },
        'path_of_light': {
            narrative: "O caminho da luz leva você a uma clareira onde uma criatura de cristal, ferida, chora. Seus cristais tremem, emitindo uma melodia dolorosa.",
            choices: [
                { text: "Tente curar a criatura com um toque gentil.", next: 'heal_creature', virtues: { compassion: 3, wisdom: 2 } }, // Aumentado para 3 e 2 para alcançar o requisito de 2 de sabedoria.
                { text: "Quebre um dos cristais para analisar a sua luz.", next: 'break_crystal', vices: { cruelty: 3, futility: 1 } },
                { text: "Ignore a criatura e procure um atalho, não há tempo para desvios.", next: 'ignore_creature', vices: { futility: 3 } }
            ]
        },
        'path_of_shadow': {
            narrative: "O caminho da sombra o leva a um abismo. Uma ponte de pedra, coberta de runas, estende-se sobre o vazio. No centro, uma gárgula de pedra murmura enigmas.",
            choices: [
                { text: "Tente decifrar as runas e o enigma da gárgula.", next: 'solve_enigma', virtues: { wisdom: 3 } }, // Aumentado para 3
                { text: "Tente pular o abismo com um salto ousado.", next: 'jump_abyss', virtues: { courage: 3 } }, // Aumentado para 3
                { text: "Ofereça algo de valor à gárgula em troca de passagem.", next: 'bribe_gargoyle', vices: { ambition: 2 } } // Aumentado para 2
            ]
        },
        'heal_creature': {
            narrative: "Sua compaixão cura a criatura. Ela, em gratidão, revela que a próxima etapa da sua jornada está em um pântano e lhe entrega uma flor luminosa que repele as criaturas das trevas. Você continua sua jornada.",
            choices: [
                { text: "Continue sua jornada para o pântano.", next: 'swamp_journey', virtues: { compassion: 1 } },
                // Agora o jogador terá 2 pontos de sabedoria e poderá escolher esta opção.
                { text: "Analise a criatura para aprender sua linguagem.", next: 'learn_language', virtues: { wisdom: 3, compassion: 1 }, required: { wisdom: 2 } }
            ]
        },
        'learn_language': {
            narrative: "Você se comunica com a criatura de cristal. Ela revela que o Coração do Bosque está corrompido por um poderoso artefato sombrio e que a única forma de salvá-lo é destruí-lo. Ela te dá um amuleto que te protege das criaturas das trevas. Você continua sua jornada.",
            choices: [
                { text: "Continue sua jornada para o pântano.", next: 'swamp_journey_advanced', virtues: { wisdom: 1, courage: 1 } }
            ]
        },
        'break_crystal': {
            narrative: "Você quebra o cristal, e a criatura grita de dor. O cristal se desintegra em poeira e você não encontra nada de valor. A floresta inteira treme e você sente a sua energia vital sendo drenada. Você continua sua jornada, mas a escuridão ao seu redor cresce.",
            choices: [
                { text: "Continue sua jornada. A dor da criatura parece ter te deixado mais forte.", next: 'gain_power_from_pain', vices: { cruelty: 1, ambition: 1 } }
            ]
        },
        'ignore_creature': {
            narrative: "Você ignora a criatura e corre pela floresta. A melodia dolorosa da criatura se mistura com os lamentos da floresta e você sente uma dor no peito. A escuridão ao seu redor cresce.",
            choices: [
                { text: "Tente encontrar uma saída.", next: 'lost_in_the_forest', vices: { futility: 1 } }
            ]
        },
        'solve_enigma': {
            narrative: "Você decifra o enigma. A gárgula se move e uma escada de pedra surge do abismo. No fundo, você encontra uma antiga adaga, capaz de cortar a escuridão. Você continua sua jornada.",
            choices: [
                { text: "Continue sua jornada para o coração da floresta.", next: 'deep_caves_of_shadows', virtues: { wisdom: 1 } }
            ]
        },
        'jump_abyss': {
            narrative: "Você decide saltar o abismo. Sua coragem é posta à prova.",
            choices: [
                // Com o ganho de 3 no início, o jogador terá 3 de coragem e poderá fazer esta escolha.
                { text: "Continue com o seu salto.", next: 'success_jump', virtues: { courage: 2 }, required: { courage: 3 } },
                { text: "Desistir e retornar para a ponte.", next: 'fail_jump', vices: { futility: 2 } }
            ]
        },
        'success_jump': {
            narrative: "Você salta com sucesso e chega ao outro lado do abismo. No fundo do abismo, você encontra uma antiga adaga, capaz de cortar a escuridão. Você continua sua jornada.",
            choices: [
                { text: "Continue sua jornada para o coração da floresta.", next: 'deep_caves_of_shadows', virtues: { courage: 1 } }
            ]
        },
        'fail_jump': {
            narrative: "Você tenta pular, mas o abismo é muito grande. Você cai no abismo.",
            choices: [
                { text: "O fim de sua jornada...", next: 'bad_end' }
            ]
        },
        'bribe_gargoyle': {
            narrative: "Você oferece um objeto de valor à gárgula. Ela examina o item com interesse. Sua ambição é posta à prova.",
            choices: [
                // O jogador terá 2 pontos de ambição e poderá fazer esta escolha.
                { text: "Ofereça mais itens de valor para a gárgula.", next: 'bribe_success', vices: { ambition: 3 }, required: { ambition: 2 } },
                { text: "O objeto não é suficiente. Deixe-a e retorne para a trilha principal.", next: 'bribe_fail' }
            ]
        },
        'bribe_success': {
            narrative: "Sua ambição impressiona a gárgula. Ela te mostra um caminho secreto, levando a um tesouro. Você se torna rico, mas sente uma dor de cabeça profunda. Você continua sua jornada.",
            choices: [
                { text: "Continue sua jornada para o coração da floresta.", next: 'deep_caves_of_shadows', vices: { ambition: 1 } }
            ]
        },
        'bribe_fail': {
            narrative: "O objeto não é suficiente. A gárgula ri de você e te empurra para o abismo.",
            choices: [
                { text: "O fim de sua jornada...", next: 'bad_end' }
            ]
        },
        'swamp_journey': {
            narrative: "O pântano é silencioso. A flor luminosa em sua mão te dá confiança, e você caminha com facilidade por entre as criaturas, que se afastam de você. Você encontra a entrada para uma caverna.",
            choices: [
                { text: "Entre na caverna.", next: 'inside_the_cave', virtues: { courage: 1 } }
            ]
        },
        'swamp_journey_advanced': {
            narrative: "O pântano é um labirinto, mas a sua nova compreensão do bosque te guia. Você encontra uma antiga árvore sábia, que te oferece um último teste de sabedoria.",
            choices: [
                // Aumentado os requisitos e os ganhos para que este caminho seja mais desafiador e gratificante.
                { text: "Tente responder a um enigma.", next: 'riddle_of_the_ancient_tree', virtues: { wisdom: 3 }, required: { wisdom: 3 } },
                { text: "Desvie-se da árvore para economizar tempo.", next: 'skip_the_riddle', vices: { futility: 1 } }
            ]
        },
        'riddle_of_the_ancient_tree': {
            narrative: "A árvore propõe um enigma sobre a natureza do tempo. Com sua sabedoria, você encontra a resposta. A árvore te presenteia com um antigo mapa que mostra o caminho mais rápido para o Coração do Bosque, evitando os perigos mais sombrios.",
            choices: [
                { text: "Siga o mapa e conclua sua jornada.", next: 'path_to_the_heart', virtues: { wisdom: 1, compassion: 1 } }
            ]
        },
        'skip_the_riddle': {
            narrative: "Você desvia da árvore, sentindo a pressa. O caminho é longo e cheio de armadilhas. Você sente uma sensação de vazio por ter perdido a oportunidade de aprender, mas eventualmente encontra uma caverna.",
            choices: [
                { text: "Continue para a caverna.", next: 'inside_the_cave', vices: { futility: 1 } }
            ]
        },
        'lost_in_the_forest': {
            narrative: "Você se perde na floresta. A escuridão te consome, e você sente que nunca mais sairá daqui. A dor da criatura de cristal te assombra.",
            choices: [
                { text: "O fim de sua jornada...", next: 'bad_end' }
            ]
        },
        'gain_power_from_pain': {
            narrative: "A dor da criatura de cristal parece ter te dado um poder. Você consegue ver as auras das criaturas da floresta. Você continua sua jornada, mas a escuridão ao seu redor te segue.",
            choices: [
                { text: "Siga em frente e encare o que vier.", next: 'confrontation_with_the_guardian', vices: { ambition: 1 } }
            ]
        },
        'deep_caves_of_shadows': {
            narrative: "As cavernas são cheias de sombras, mas a adaga que você tem as repele. Você avança até o coração das cavernas e encontra um enorme golem de pedra.",
            choices: [
                { text: "Tente se aproximar silenciosamente e roubar a relíquia.", next: 'steal_relic', vices: { futility: 1, ambition: 1 } },
                { text: "Tente acordar o golem com uma canção suave e pacífica.", next: 'wake_golem', virtues: { compassion: 1, wisdom: 1 }, required: { compassion: 3 } },
                { text: "Tente acordar o golem para uma luta.", next: 'fight_golem', vices: { cruelty: 1, ambition: 1 } }
            ]
        },
        'inside_the_cave': {
            narrative: "A caverna é silenciosa. Você avança até encontrar um enorme golem de pedra. O golem está dormindo e uma relíquia de grande poder está em suas mãos. O que você faz?",
            choices: [
                { text: "Tente se aproximar silenciosamente e roubar a relíquia.", next: 'steal_relic', vices: { futility: 1, ambition: 1 } },
                { text: "Tente acordar o golem com uma canção suave e pacífica.", next: 'wake_golem', virtues: { compassion: 1, wisdom: 1 }, required: { wisdom: 3 } },
                { text: "Tente acordar o golem para uma luta.", next: 'fight_golem', vices: { cruelty: 1, ambition: 1 } }
            ]
        },
        'confrontation_with_the_guardian': {
            narrative: "Você encontra um ser guardião do bosque. Ele diz que você está no caminho errado, e que a sua alma está se corrompendo. O que você faz?",
            choices: [
                { text: "Aceita as palavras do guardião e tente se redimir.", next: 'redemption', virtues: { wisdom: 1, compassion: 1 } },
                { text: "Não se importa com o que ele diz e o ataca.", next: 'end_tyrant', vices: { cruelty: 1, ambition: 1 } }
            ]
        },
        'steal_relic': {
            narrative: "Você tenta roubar a relíquia, mas o golem acorda. Ele te esmaga com a mão.",
            choices: [
                { text: "O fim de sua jornada...", next: 'bad_end' }
            ]
        },
        'wake_golem': {
            narrative: "Sua canção acalma o golem. Ele entrega a relíquia a você e te mostra o caminho para fora da caverna. A relíquia te dá um poder enorme.",
            choices: [
                { text: "Use a relíquia para se tornar um herói e restaurar a floresta.", next: 'end_hero', virtues: { courage: 1, wisdom: 1 } },
                { text: "Use a relíquia para se tornar um deus.", next: 'end_tyrant', vices: { ambition: 1, cruelty: 1 } }
            ]
        },
        'fight_golem': {
            narrative: "Você ataca o golem, mas ele é muito mais forte do que você imaginava. Ele te esmaga com sua mão de pedra.",
            choices: [
                { text: "O fim de sua jornada...", next: 'bad_end' }
            ]
        },
        'redemption': {
            narrative: "Você se redime e se torna um herói. O guardião te ajuda a encontrar o caminho para o coração do bosque e você o restaura.",
            choices: [
                { text: "Aceite o convite do guardião para ficar e proteger o bosque.", next: 'end_hero' }
            ]
        },
        'path_to_the_heart': {
            narrative: "Com o mapa da árvore sábia, você navega pelos últimos perigos da floresta. O Coração do Bosque está à sua frente, pulsando com energia pura. O que você fará?",
            choices: [
                { text: "Conecte-se com o coração, restaurando a floresta e tornando-se seu protetor.", next: 'end_hero', virtues: { compassion: 1 } },
                { text: "Tente absorver todo o poder para si mesmo.", next: 'end_tyrant', vices: { ambition: 1, cruelty: 1 } }
            ]
        },

        // Finais do Jogo
        'bad_end': { narrative: "A escuridão do bosque te consumiu. A sua jornada termina, mas o seu legado de trevas apenas começou. Você se perde para sempre.", is_ending: true },
        'end_hero': { narrative: "Você restaurou o equilíbrio do bosque. As Virtudes que você cultivou te tornaram um herói. Seu nome é ecoado pelas árvores e você se torna um protetor da vida, vivendo em harmonia com o Bosque.", is_ending: true },
        'end_tyrant': { narrative: "Você usou o poder para seu próprio ganho. O bosque, outrora vibrante, agora se curva à sua vontade. As sombras te abraçam. Você se torna um tirano, mas solitário em sua ambição. A sua jornada termina, mas o seu reinado de trevas apenas começou.", is_ending: true }
    };

    // Estado do Jogo
    let stats = {
        virtues: { courage: 0, wisdom: 0, compassion: 0 },
        vices: { cruelty: 0, ambition: 0, futility: 0 }
    };
    let currentNodeId = 'start';
    const STAT_MAX = 10;

    // Elementos DOM
    const narrativeTextEl = document.getElementById('narrative-text');
    const choicesContainerEl = document.getElementById('choices-container');
    const endModal = document.getElementById('end-modal');
    const endTitleEl = document.getElementById('end-title');
    const endTextEl = document.getElementById('end-text');
    const restartBtn = document.getElementById('restart-btn');

    // Funções do Jogo
    // AQUI ESTÁ A CORREÇÃO: A lógica para encontrar e atualizar as barras foi refinada
    // para garantir que a largura seja sempre calculada e aplicada corretamente.
    function updateStatsUI() {
        for (const statType in stats) {
            for (const statName in stats[statType]) {
                const bar = document.getElementById(`${statType}-${statName}-bar`);
                if (bar) {
                    const percentage = (stats[statType][statName] / STAT_MAX) * 100;
                    bar.style.width = `${Math.min(percentage, 100)}%`;
                }
            }
        }
    }

    function displayNode(nodeId) {
        const node = gameData[nodeId];
        if (!node) {
            console.error("Node not found:", nodeId);
            return;
        }

        if (node.is_ending) {
            showEnding(node.narrative);
            return;
        }

        narrativeTextEl.textContent = node.narrative;
        choicesContainerEl.innerHTML = '';

        // Filtra e exibe as escolhas baseadas nos requisitos de status
        node.choices.forEach(choice => {
            let canTakeChoice = true;
            let requiredStatsText = "";
            
            if (choice.required) {
                const requiredStatEntries = Object.entries(choice.required);
                requiredStatsText = requiredStatEntries.map(([key, value]) => `[Requer ${key.charAt(0).toUpperCase() + key.slice(1)}: ${value}]`).join(' ');
                
                for (const [stat, value] of requiredStatEntries) {
                    // Verifica se o stat é uma virtude ou um vício para pegar o valor correto
                    const currentStatValue = stats.virtues[stat] !== undefined ? stats.virtues[stat] : stats.vices[stat];
                    if (currentStatValue < value) {
                        canTakeChoice = false;
                        break; // Se um requisito não é atendido, não há necessidade de continuar
                    }
                }
            }

            const button = document.createElement('button');
            const buttonText = `${choice.text} ${requiredStatsText}`;
            
            button.className = "choice-button text-left text-white font-medium py-4 px-6 rounded-lg text-lg transition-colors";
            
            if (canTakeChoice) {
                button.classList.add('hover:bg-gray-700');
                button.onclick = () => handleChoice(choice);
            } else {
                button.classList.add('unavailable-choice');
                button.disabled = true;
            }

            button.textContent = buttonText;
            choicesContainerEl.appendChild(button);
        });

        updateStatsUI();
    }

    function handleChoice(choice) {
        // Atualiza os status baseados na escolha
        if (choice.virtues) {
            for (const virtue in choice.virtues) {
                stats.virtues[virtue] += choice.virtues[virtue];
                stats.virtues[virtue] = Math.min(stats.virtues[virtue], STAT_MAX);
            }
        }
        if (choice.vices) {
            for (const vice in choice.vices) {
                stats.vices[vice] += choice.vices[vice];
                stats.vices[vice] = Math.min(stats.vices[vice], STAT_MAX);
            }
        }
        
        currentNodeId = choice.next;
        displayNode(currentNodeId);
    }

    function showEnding(text) {
        endTitleEl.textContent = "FIM DA JORNADA";
        endTextEl.textContent = text;
        endModal.classList.remove('hidden');
    }

    function restartGame() {
        stats = {
            virtues: { courage: 0, wisdom: 0, compassion: 0 },
            vices: { cruelty: 0, ambition: 0, futility: 0 }
        };
        currentNodeId = 'start';
        endModal.classList.add('hidden');
        displayNode(currentNodeId);
    }

    // Ouvintes de Eventos
    restartBtn.addEventListener('click', restartGame);

    // Inicia o jogo ao carregar a página
    window.onload = () => displayNode(currentNodeId);
</script>
</body>
</html>
